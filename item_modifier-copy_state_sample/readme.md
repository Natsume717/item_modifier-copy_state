# item_modifier-apply_bonus
item_modifierのapply_bonusに関するサンプルになります。

~詳しくはブログ記事『[]()』を参考にしてください。~<br>
現在執筆中

<h3>概要</h3>

apply_bonusを指示することで、ブロック破壊時のアイテムドロップ数を変更できます。

それらのドロップ数については、破壊時に使用したアイテムに指示したエンチャントが付与されていることが必須です。<br>
また、そのエンチャントレベルによってドロップする個数が変化します。

<h3>使い方</h3>

データパック導入後、ワールドに入ることで3種のブロック30個ずつとネザライトツルハシが3つ付与されます。<br>
それぞれのツルハシには、エンチャントの付与がないもの、フレイム、フレイム10というように異なるエンチャント内容が付与されています。

付与されたブロックを設置後、各ネザライトツルハシを使って壊すことで、apply_bonusを体験することができます。

---

3種のブロックのドロップ品は変更されているほか、apply_bonusに必須な項目であるfomulaによってドロップする数の計算方法が異なるため、以下の表にまとめました。

|ブロック名|ドロップアイテム|fomula|
|---|---|---|
|鉄ブロック|レッドストーンダスト|minecraft:binomial_with_bonus_count|
|ラピスラズリブロック|アメジストの欠片|minecraft:uniform_bonus_count|
|ダイヤモンドブロック|エメラルド|minecraft:ore_drops|

<h3>ドロップ数の計算方法</h3>

それぞれの計算方法について解説しています。

<h4>binomial_with_bonus_count</h4>

二項分布を用いてドロップ数を導き出す。<br>
注意点としては、<b>通常のドロップに加えて、追加されるドロップ数を割り出すということ。</b>

extraとprobabilityの2項目を指示する必要があり、extraは整数で、probabilityは0~1の間で指示する。

具体的な式は以下の通り。<br>
n=level + extra、p=probabilityとする。levelはエンチャントレベルとなっているほか、xは成功回数の意味を持つ。

$$ _nC_xp^x(1-p)^{n-x} $$

<h5>具体例</h5>
apply_bonusでフレイムのエンチャントを指示したとして、フレイムのレベル2、extraを3、probabilityを0.2としたとする。

また、xは1と仮定したうえで計算する。<br>
これは+1個ドロップする確立の計算になるため、全体のドロップ率を知りたい場合には後述するサイトを利用することをおすすめする。

まとめると、x=1,n=5,p=0.2で計算していく。<br>
この場合は以下の通り。

$$ _5C_1\times0.2^1\times0.8^4 $$

計算結果としては、0.4096となるため、40％程度の確率で、通常のドロップに加えて+1個ドロップする数が増えるということになる。

以下のサイトで調べたほうが早い。<br>
[keisan　生活や実務に役立つ計算サイト-二項分布](https://keisan.casio.jp/exec/system/1161228843)

|補足<br>loot_tableのrollが1よりも大きい場合については調査中。rollが大きければ大きいだけドロップ数が増えることは間違いないが、その計算式などは不明|
|:-|


<h4>uniform_bonus_count</h4>

uniform_bonus_countでは、均一分布を利用する。

uniform_bonus_countを指示したことでbonusMultiplierを決めなければならず、これはエンチャントのレベルとかけて、ドロップ数の上限とする。

例えばエンチャントのレベルが1として、bonusMultiplierを2とした場合には、$1\times2$となり、2が最大数となる。

加えて、loot_tableのroll（通常ドロップ数）の数を加えるので、rollに1を設定していた場合には、最大3つのアイテムがドロップする。


<h4>ore_drops</h4>

Minecraft独自の関数が用いられている。<br>
式はこちら。

$ max(1; randomInt[0 .. (Level + 2)]) $

randomInt[0 .. (Level + 2)]の部分でまずは乱数を決める。<br>
Levelはエンチャントのレベルを指しているため、指示したエンチャントがレベル1であるならば、0から2の間で選出される。

|注意<br>乱数を決める際に0は含まれるが、上限となる値は含まれない。上記の例で言えば、$ 1+2=3 $だが、3は含まれないということ。<br>[日本語版wiki](https://ja.minecraft.wiki/w/%E3%82%A2%E3%82%A4%E3%83%86%E3%83%A0%E4%BF%AE%E9%A3%BE%E5%AD%90)では記述が消されているが、[英語版](https://minecraft.wiki/w/Item%20modifier)ではそれぞれ*inclusive*と*exclusive*の記述がある|
|:-|

乱数を選出した後は、1とその乱数を比べ、大きい方が選ばれる。<br>
そのため、0が選ばれた場合には1が選ばれることになり、確実に1個以上ドロップするようになっている。

|loot_tableのrollは選ばれた数字に加算されず、繰り返す回数として捉えるのが良い。<br>上記の例でrollが10であった場合、1個か2個付与されるものが10回繰り返されたうえでドロップ数が決まるイメージ|
|:-|